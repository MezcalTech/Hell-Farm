function Rectangle(r,e,t,a,n){this.x=null==r?0:r,this.y=null==e?0:e,this.width=null==t?0:t,this.height=null==a?this.width:a,this.dir=null==n?null:n,this.intersects=function(r){return null!=r?this.x<r.x+r.width&&this.x+this.width>r.x&&this.y<r.y+r.height&&this.y+this.height>r.y:void window.console.warn("Missing parameters on function intersects")},this.fill=function(r){null==r?window.console.warn("Missing parameters on function fill"):r.fillRect(this.x,this.y,this.width,this.height)}}function random(r){return Math.floor(Math.random()*r)}function reset(){score=0,dir=1,player.x=canvas.width/2,player.y=canvas.height/2,wall=[],recursos=0,score=0,ENEMYS_SPAWN=5,barreras=[],playerConstructor.x=64,playerConstructor.y=64,dirConstructor=1,gameover=!1}function paint(r){var e=0,t=0;r.fillStyle="#000",r.fillRect(0,0,canvas.width,canvas.height);var a=new Image(800,800);for(a.src="img/Lvl 1.png",r.drawImage(a,0,0),r.fillStyle="#00B",center.fill(r),r.drawImage(base,canvas.width/2-70,canvas.height/2-60),player.drawImageArea(r,sprite,direcciones[dir].x,direcciones[dir].y,32,32),playerConstructor.drawImageArea(r,spriteConstructor,direcciones[dirConstructor].x,direcciones[dirConstructor].y,32,32),r.fillStyle="#009",e=0,t=wall.length;t>e;e+=1)wall[e].drawImageArea(r,spriteEnemigoOgro,direccionesEnemigo[wall[e].dir].x,direccionesEnemigo[wall[e].dir].y,80,96);for(e=0;e<barreras.length;e++)barreras[e].drawImageArea(r,spriteRoca,0,0,32,32);r.fillStyle="#f00",r.fillStyle="#fff",pause?(gameover?r.fillText("GAME OVER",canvas.width/2-50,canvas.height/2):r.fillText("PAUSE",canvas.width/2-50,canvas.heigth/2),r.textAlign="left"):(r.fillText("SCORE: "+Math.floor(score),50,50),r.fillText("RECURSOS: "+recursos,canvas.width-200,50))}function act(){var r=0;if(!pause){for(gameover&&reset(),lastPress==KEY_UP,lastPress==KEY_RIGHT&&(dir=1),lastPress==KEY_DOWN&&(dir=2),lastPress==KEY_LEFT&&(dir=3),pressing[KEY_UP]&&player.y>0&&(player.y-=2,dir=0),pressing[KEY_RIGHT]&&player.x<canvas.width-32&&(player.x+=2,dir=1),pressing[KEY_DOWN]&&player.y<canvas.height-32&&(player.y+=2,dir=2),pressing[KEY_LEFT]&&player.x>2&&(player.x-=2,dir=3),player.y>canvas.height&&(player.y=0),player.y<0&&(player.y=canvas.height);r<wall.length;){var e=enemyMove(wall[r]);center.intersects(wall[r])&&(gameover=!0,pause=!0),(player.intersects(wall[r])||playerConstructor.intersects(wall[r]))&&(e=!0),e&&(wall.splice(r,1),recursos+=10,score+=1),r++}score+=.1,score/50>SCORE_OFFSET&&(ENEMYS_SPAWN++,SCORE_OFFSET++)}lastPress==KEY_ENTER&&(pause=!pause,lastPress=null)}function actConstructor(){pause||(gameover&&reset(),pressing[KEY_W]&&playerConstructor.y>0&&(playerConstructor.y-=2,dirConstructor=0),pressing[KEY_D]&&playerConstructor.x<canvas.width-32&&(playerConstructor.x+=2,dirConstructor=1),pressing[KEY_S]&&playerConstructor.y<canvas.height-32&&(playerConstructor.y+=2,dirConstructor=2),pressing[KEY_A]&&playerConstructor.x>2&&(playerConstructor.x-=2,dirConstructor=3),pressing[KEY_SPACE]&&recursos>=30&&(constructingBarier=!0),constructingBarier&&!pressing[KEY_SPACE]&&(constructingBarier=!1,0==dirConstructor&&barreras.push(new Rectangle(playerConstructor.x,playerConstructor.y-playerConstructor.height,32,32,playerConstructor.dir)),1==dirConstructor&&barreras.push(new Rectangle(playerConstructor.x+playerConstructor.width,playerConstructor.y,32,32,playerConstructor.dir)),2==dirConstructor&&barreras.push(new Rectangle(playerConstructor.x,playerConstructor.y+playerConstructor.height,32,32,playerConstructor.dir)),3==dirConstructor&&barreras.push(new Rectangle(playerConstructor.x-playerConstructor.width,playerConstructor.y,32,32,playerConstructor.dir)),recursos-=30),playerConstructor.x>canvas.width&&(playerConstructor.x=0),playerConstructor.y>canvas.height&&(playerConstructor.y=0),playerConstructor.x<0&&(playerConstructor.x=canvas.width),playerConstructor.y<0&&(playerConstructor.y=canvas.height))}function enemyMove(r){if(actBarreras(r))switch(r.dir){case 0:r.y-=1;break;case 1:r.x+=1;break;case 2:r.y+=1;break;case 3:r.x-=1}return r.x>canvas.width||r.x<0||r.y<0||r.y>canvas.height}function actBarreras(r){for(var e=0;e<barreras.length;e++)if(barreras[e].intersects(r))return r.blocked===STONE_BREAKER&&barreras.splice(e,1),r.blocked++,!1;return!0}function repaint(){window.requestAnimationFrame(repaint),paint(ctx)}function run(){setTimeout(run,17),act(),actConstructor()}function init(){canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),player=new Rectangle(canvas.width/2,canvas.height/2,32,32),playerConstructor=new Rectangle(64,64,32,32),center=new Rectangle(canvas.width/2-60,canvas.height/2-40,90,80),ctx.font="15px Arial",run(),repaint()}function cargarEnemigo(){var r=random(4),e=0===r||2===r?random(canvas.width-40):1===r?0:canvas.width-40,t=1===r||3===r?random(canvas.height-48):2===r?0:canvas.height-48,a=new Rectangle(e,t,40,48,r);a.blocked=0,wall.push(a)}function cargarEnemigos(){if(!pause)for(var r=random(ENEMYS_SPAWN),e=0;r>e;e++)cargarEnemigo()}function actEnemies(){}var KEY_ENTER=13,KEY_LEFT=37,KEY_UP=38,KEY_RIGHT=39,KEY_DOWN=40,ENEMYS_SPAWN=5,SCORE_OFFSET=1,STONE_BREAKER=10;canvas=null,ctx=null,lastPress=null,pause=!0,gameover=!0,dir=0,score=0,wall=new Array,player=null,food=null,constructingBarier=!1;var KEY_A=65,KEY_W=87,KEY_D=68,KEY_S=83,KEY_SPACE=32,barreras=[],dirConstructor=0,center=null,score=0,recursos=0,pressing=[],playerConstructor=null,TILESIZE=32,base=new Image,sprite=new Image;sprite.src="img/rpg_char.png",base.src="img/BASE.png";var spriteEnemigoOgro=new Image(160,192);spriteEnemigoOgro.src="img/Monster2.jpg";var spriteConstructor=new Image(96,128);spriteConstructor.src="img/rpg_char2.png";var spriteRoca=new Image(32,32);spriteRoca.src="img/rockwall.png";var direccionesEnemigo={0:{x:0,y:288},1:{x:0,y:192},2:{x:0,y:0},3:{x:0,y:96}},direcciones={0:{x:32,y:96},1:{x:32,y:64},2:{x:0,y:0},3:{x:0,y:32}};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(r){window.setTimeout(r,17)}}(),document.addEventListener("keydown",function(r){lastPress=r.keyCode,pressing[r.keyCode]=!0},!1),document.addEventListener("keyup",function(r){pressing[r.keyCode]=!1},!1),Rectangle.prototype.drawImageArea=function(r,e,t,a,n,s){e.width?r.drawImage(e,t,a,n,s,this.x,this.y,this.width,this.height):r.strokeRect(this.x,this.y,this.width,this.height)},window.addEventListener("load",init,!1);var ogreSpawner=setInterval(cargarEnemigos,2e3);